# utils for UCR files

years <- years <- c("^76$"         = "1976",
                    "^99$"         = "1999",
                    "^16$"         = "2016",
                    "^79$"         = "1979",
                    "NOT REPORTED" = NA,
                    "^75$"         = "1975",
                    "^79$"         = "1979",
                    "^80$"         = "1980",
                    "^81$"         = "1981",
                    "^82$"         = "1982")

states <- c("washington, d.c"    = "district of columbia",
            "washington, d"      = "district of columbia",
            "dist of columbia"   = "district of columbia",
            "55"                 = "guam",
            "54"                 = "american samoa",
            "53"                 = "puerto rico",
            "52"                 = "canal zone",
            "99"                 = NA,
            "not reported"       = NA,
            "62"                 = "virgin islands")

division <- c("e. south central"            = "east south central",
              "east st south ceast tral"    = "east south central",
              "west ast t south ceast tral" = "west south central,",
              "east st north central"       = "east north central",
              "west ast t north central"    = "west north central",
              "east st north ceast tral"    = "east north central",
              "west ast t north ceast tral" = "west north central",
              "w. south central"            = "west south central",
              "e. north central"            = "east north central",
              "east st north central"       = "east north central",
              "w. north central"            = "west north central",
              "east st south central"       = "east south central",
              "west ast t south central"    = "west south central",
              "east north ceast tral"       = "east north central",
              "west nceast "                = "west north central",
              "neast  east land"            = "west north central",
              "u. s. posseast sion"         = "possessions",
              "u.s. possessions"            = "possessions",
              "u. s. posessions"            = "possessions",
              " states"                     = "",
              "eng1and"                     = "england",
              "al,ky,ms,tn"                 = "east south central",
              "az,co,id,mt,nv,n"            = "mountain",
              "ar,la,ok, texas"             = "west south central",
              "ak,ca,hi,or,wa"              = "pacific",
              "ct,me,ma,nh"                 = "new england",
              "de,fl,ga,md,nort"            = "south atlantic",
              "il,in,mi,oh,wi"              = "east north central",
              "ia,ks,mn,mo,ne,n"            = "west north central",
              "nj ny pa"                    = "mid-atlantic",
              "w ncen states"               = "west north central",
              "s atlantic sts"              = "south atlantic",
              "^0%"                         = "possessions",
              "^1$"                         = "new england",
              "^2$"                         = "mid-atlantic",
              "^3$"                         = "east north central",
              "^4$"                         = "west north central",
              "^5$"                         = "south atlantic",
              "^6$"                         = "east south central",
              "^7$"                         = "west south central",
              "^8$"                         = "mountain",
              "^9$"                         = "pacific",
              "alabama, kentucky, mississippi, tennessee"          = "east south central",
              "arizona, colorado, idaho, montana, nevada, new"     = "mountain",
              "arkansas, louisiana, oklahoma, texas"               = "west south central",
              "alaska, california, hawaii, oregon, washington"     = "pacific",
              "connecticut, maine, massachusetts, new hampshire,"  = "new enland",
              "delaware, florida, georgia, maryland, north"        = "south atlantic",
              "illinois, indiana, michigan, ohio, wisconsin"       = "east north central",
              "iowa, kansas, minnesota, missouri, nebraska, north" ="west north central",
              "new jersey, new york, pennsylvania"                 = "mid-atlantic",
              "midd1east atlantic"          = "mid-atlantic",
              "midast atlantic"             = "mid-atlantic",
              "^u$"                         = NA,
              "e\\."                        = "east ",
              "w\\."                        = "west ",
              "cntrl"                       = "central",
              "middle"                      = "mid",
              "east st south ceast tral"    = "east south central",
              "west ast t south ceast tral" = "west south central",
              "posseast sions"              = "possessions",
              "west nceast "                = "west north central",
              "east st north ceast tral"    = "east north central",
              "new enland"                  = "new england",
              "w ncen"                      = "west north central",
              "midd1e atlantic"             = "mid-atlantic",
              "mid "                        = "mid-",
              "u. s. possession"            = "possessions",
              ":.*"                         = "",
              "^e s.cent$"                  = "east south central",
              "^w s.cent$"                  = "west south central",
              "^new englnd sts$"            = "new england",
              "^sth atl$"                   = "south atlantic",
              "^e n.cent$"                  = "east north central",
              "^w n.cent$"                  = "west north central",
              "^mid-atl$"                   = "mid-atlantic",
              "^est sth cntl sttes$"        = "east south central",
              "^wst sth cntl sttes$"        = "west south central",
              "^new englnd sttes$"          = "new england",
              "^sth atlntc$"                = "south atlantic",
              "^est nth cntl sttes$"        = "east north central",
              "^wst nth cntl sttes$"        = "west north central",
              "^mddle atltc sttes$"         = "mid-atlantic")

group_number <- c("^MSA cts 100000/over$"   = "msa county 100,000+",
                  "^Cts 25000-49999$"       = "city 25,000 thru 49,999",
                  "^Cts 250000-499999$"     = "city 250,000 thru 499,999",
                  "^Cts 10000-24999$"       = "city 10,000 thru 25,000",
                  "^Cits 2500-9999$"        = "city 2,500 thru 9,999",
                  "^Cts undr 2,500$"        = "city under 2,500",
                  "^Cts 100000-249999$"     = "city 100,000 thru 249,999",
                  "^MSA cts 10000-24999$"   = "msa county 10,000 thru 24,999",
                  "^N-MS cts udr 10,000$"   = "non-msa county under 10,000",
                  "^MSA cts 25000-99999$"   = "msa county 25,000 thru 99,999",
                  "^N-MS cts 10000-24999$"  = "msa county 10,000 thru 24,999",
                  "^N-MS cts 25000-99999$"  = "msa county 25,000 thru 99,999",
                  "^Cts 50000-99999$"       = "city 50,000 thru 99,999",
                  "^Al cts mlln ovr$"       = "city 1,000,000+",
                  "^Cts 500000-999999$"     = "city 500,000 thru 999,999",
                  "^MS cts udr 10000$"      = "msa county under 10,000",
                  "^N-MSA cots 10000$"      = "non-msa county 10,000 thru 24,999",
                  "^All cities 1,000,000 or over$" = "city 1,000,000+",
                  "^ALL CITIES 250K\\+$"      = "city 250,000+",
                  "^Cit < 2,500$"             = "city under 2,500",
                  "^Cit 1,000,000 \\+$"       = "city 1,000,000+",
                  "^Cit 10,000-24,999$"       = "city 10,000 thru 24,999",
                  "^Cit 100,000-249,999$"     = "city 100,000 thru 249,999",
                  "^Cit 2,500-9,999$"         = "city 2,500 thru 9,999",
                  "^Cit 25,000-49,999$"       = "city 25,000 thru 49,999",
                  "^Cit 250,000-499,999$"     = "city 250,000 thru 499,999",
                  "^Cit 50,000-99,999$"       = "city 50,000 thru 99,999",
                  "^Cit 500,000-999,999$"     = "city 500,000 thru 999,999",
                  "^CIT BET 100-249K$"        = "city 100,000 thru 249,999",
                  "^CIT BET 2.5-9.9K$"        = "city 2,500 thru 9,999",
                  "^CIT BT 100K-250K$"        = "city 100,000 thru 249,999",
                  "^CIT BT 2.5K-9.9K$"        = "city 2,500 thru 9,999",
                  "^CITI BET 10K-25K$"        = "city 10,000 thru 24,999",
                  "^CITI BET 50K-99K$"        = "city 50,000 thru 99,999",
                  "^CITIE BET 10-24K$"        = "city 10,000 thru 24,999",
                  "^CITIE BET 25-49K$"        = "city 25,000 thru 49,999",
                  "^CITIE BET 50-99K$"        = "city 50,000 thru 99,999",
                  "^CITIE UNDER 2.5K$"        = "city under 2,500",
                  "^Cities 10,000 thru 24,999$"   = "city 10,000 thru 25,000",
                  "^Cities 100,000 thru 249,999$" = "city 100,000 thru 249,999",
                  "^Cities 2,500 thru 9,999$"     = "city 2,500 thru 9,999",
                  "^Cities 25,000 thru 49,999$"   = "city 25,000 thru 49,999",
                  "^Cities 250,000 thru 499,999$" = "city 250,000 thru 499,999",
                  "^Cities 50,000 thru 99,999$"   = "city 50,000 thru 99,999",
                  "^Cities 500,000 thru 999,999$" = "city 500,000 thru 999,999",
                  "^Cities under 2,500$"     = "city under 2,500",
                  "^CITS BET 25K-50K$"       = "city 25,000 thru 49,999",
                  "^MSA co. < 10,000$"       = "msa county under 10,000",
                  "^MSA co. 10,000-24,999$"  = "msa county 10,000 thru 24,999",
                  "^MSA co. 100,000 \\+$"    = "msa county 100,000+",
                  "^MSA co. 25,000-99,999$"  = "msa county 25,000 thru 99,999",
                  "^MSA COUNTIES$"           = "msa county",
                  "^MSA counties 10,000 thru 24,999$" = "msa county 10,000 thru 24,999",
                  "^MSA counties 100,000 or over$"    = "msa county 100,000+",
                  "^MSA counties 25,000 thru 99,999$" = "msa county 25,000 thru 99,999",
                  "^MSA counties under 10,000$"       = "msa county under 10,000",
                  "^MSA St Police$"                   = "msa state police",
                  "^NON-MSA CNTIES$"                  = "non-msa county",
                  "^Non-MSA co. < 10,000$"            = "non-msa county under 10,000",
                  "^Non-MSA co. 10,000-24,999$"       = "non-msa county 10,000 thru 24,999",
                  "^Non-MSA co. 100,000 \\+$"         = "non-msa county 100,000+",
                  "^Non-MSA co. 25,000-99,999$"       = "non-msa county 25,000 thru 99,999",
                  "^Non-MSA counties 10,000 thru 24,999$" = "non-msa county 10,000 thru 24,999",
                  "^Non-MSA counties 100,000 or over$"    = "non-msa county 100,000+",
                  "^Non-MSA counties 25,000 thru 99,999$" = "non-msa county 25,000 thru 99,999",
                  "^Non-MSA counties under 10,000$"       = "non-msa county under 10,000",
                  "^Non-MSA St Police$"    = "non-msa state police",
                  "^NON-SMSA COUNTIE$"     = "non-msa county",
                  "^Possessions$"          = "possessions",
                  "^SMSA COUNTIES$"        = "msa county",

                  "^8d$" = "non-msa counties under 10,000",
                  "^9a$" = "msa counties 100,000+",
                  "^4$"  = "cities 25,000 thru 49,999",
                  "^1c$" = "cities 250,000 thru 499,999",
                  "^5$"  = "cities 10,000 thru 24,999",
                  "^6$"  = "cities 2,500 thru 9,999",
                  "^7$"  = "cities under 2,500",
                  "^2$"  = "cities 100,000 thru 249,999",
                  "^9c$" = "msa counties 10,000 thru 24,999",
                  "^9d$" = "msa counties under 10,000",
                  "^9b$" = "msa counties 25,000 thru 99,999",
                  "^8c$" = "non-msa counties 10,000 thru 24,999",
                  "^8b$" = "non-msa counties 25,000 thru 99,999",
                  "^3$"  = "cities 50,000 thru 99,999",
                  "^1a$" = "cities 1,000,000 or over",
                  "^1b$" = "cities 500,000 thru 999,999",
                  "^9e$" = "msa state police",
                  "^8e$" = "non-msa state police",
                  "^8a$" = "non-msa counties 100,000+")

sub_group <- c("^smsa 100k\\+$"     = "msa county 100,000+",
               "^citie bet 25-49k$" = "city 25,000 thru 49,999",
               "^cit bet 250-499k$" = "city 250,000 thru 499,999",
               "^citie bet 10-24k$" = "city 10,000 thru 24,999",
               "^cit bet 2.5-9.9k$" = "city 2,500 thru 9,999",
               "^smsa 25-99k$"      = "msa county 25,000 thru 99,999",
               "^cit bet 100-249k$" = "city 100,000 thru 249,999",
               "^smsa 10-24.9k$"    = "msa county 10,000 thru 24,999",
               "^non-smsa 10-24k$"  = "non-msa county 10,000 thru 24,999",
               "^non-smsa <10k$"    = "non-msa county under 10,000",
               "^non-smsa 25-99k$"  = "non-msa county 25,000 thru 99,999",
               "^citie under 2.5k$" = "city under 2,500",
               "^citie bet 50-99k$" = "city 50,000 thru 99,999",
               "^cit bet 500-999k$" = "city 500,000 thru 999,999",
               "^all cities 1m\\+$" = "city 1,000,000+",
               "^non-smsa 100k\\+$" = "non-msa county 100,000+",
               "^smsa count <10k$"  = "msa county under 10,000",
               "^95$"               = NA,
               "^85$"               = NA,
               "^msa 100k\\+$"      = "msa county 100,000+",
               "^citie bt 25k-50k$" = "city 25,000 thru 49,999",
               "^cit bet 250-500k$" = "city 250,000 thru 499,999",
               "^cit bet 2.5k-10k$" = "city 2,500 thru 9,999",
               "^citie bt 10k-25k$" = "city 10,000 thru 24,999",
               "^cit bt 100k-250k$" = "city 100,000 thru 249,999",
               "^msa 10k-25k$"      = "msa county 10,000 thru 24,999",
               "^msa 25k-100k$"     = "msa county 25,000 thru 99,999",
               "^non-msa 10k-25k$"  = "non-msa county 10,000 thru 24,999",
               "^non-msa <10k$"     = "non-msa county under 10,000",
               "^non-msa 25k-100k$" = "non-msa county 25,000 thru 99,999",
               "^citi bt 50k-100k$" = "city 50,000 thru 99,999",
               "^cit bt 500k-999k$" = "city 500,000 thru 999,999",
               "^msa count <10k$"   = "msa county under 10,000",
               "^non-msa 100k\\+$"  = "non-msa county 100,000+")

save_files <- function(data, year, file_name, save_name) {
  assign(paste0(file_name, year), data) # Change name
  Write(codebook(data),
        file = paste0(file_name, "codebook_", year, ".txt"))

  save( list = paste0(file_name, year),
        file = paste0(save_name, year, ".rda"))
  do.call("write_dta", list(as.name(paste0(file_name, year)),
                            path = paste0(save_name,
                                          year, ".dta")))
  do.call("write_csv", list(as.name(paste0(file_name, year)),
                            path = paste0(save_name,
                                          year, ".csv")))
  do.call("write_sav", list(as.name(paste0(file_name, year)),
                            path = paste0(save_name,
                                          year, ".sav")))
  do.call("rm", list(as.name(paste0(file_name, year))))
}

save_as_zip <- function(file_name) {
  file_ext <- c("rda", "dta", "csv", "sav")
  all_files <- list.files()
  codebooks <- all_files[grep("codebook", all_files)]
  for (i in seq_along(file_ext)) {
    zip_files <- all_files[grep(file_ext[i], all_files)]
    zip_files <- c(zip_files, codebooks)

    zip::zip(zipfile = paste0(file_name,
                              file_ext[i], ".zip"),
             files = zip_files)
  }
}

save_raw_as_zip <- function(file_name) {
  all_files <- list.files()
  zip::zip(zipfile = paste0(file_name, ".zip"),
           files = all_files)
}